---
title: "Tüseb"
author: "beyza"
date: "2022-12-08"
output: html_document
---

load libraries
```{r}
library(argparse)
library(findpython)
library(sp)
library(SeuratObject)
library(Seurat)
library(hdf5r)
library(devtools)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(patchwork)
library(devtools)
library(AUCell)
library(Seurat)
```

For GeneSets
```{r}
genes <- unique(c("CD9", "CD63", "CD81", "PDCD6IP", "TSG101", "ARF6", "ANXA1", "CD82", "CD37", "VTA1", "CD80", "CD86", "SIRT6", "SDCBP", "TRIM5", "CLTC", "VPS4A", "VPS4B", "HSPA4", "HSPA1A", "HSPA4", "HSPA8", "HSPA1B" ,"HSPA5", "HSPA14", "HSPA2", "HSPA9", "HSPD1", "HSP90AA1", "HSP90AB1", "PLD1", "PLD2", "CD40", "CHMP4B", "CHMP4A", "CHMP4C", "FLOT1", "FLOT2", "ANXA2", "ANXA6", "ANXA4", "ANXA7", "CFL1", "CFL2", "PFN1", "PFN2"))
geneSets <- GeneSet(genes, setName="geneSet2")

exprMatrix <- Seurat_file
```

1. Score gene signatures

1.1. Build gene-expression rankings for each cell
Her hücre için, genler en yüksekten en düşüğe doğru sıralanır. Aynı ifade değerine sahip genler karıştırılır. Bu nedenle, '0' ifadesine sahip genler, sıralamanın sonunda rastgele sıralanır.
```{r}
cells_rankings <- AUCell_buildRankings(counts)
cells_rankings
```
1.2. Calculate enrichment for the gene signatures (AUC)
```{r}
cells_AUC <- AUCell_calcAUC(geneSets, cells_rankings)
```


2. Determine the cells with the given gene signatures or active gene sets
```{r}
cells_assignment <- AUCell_exploreThresholds(cells_AUC, plotHist=TRUE, assign=TRUE)
cells_assignment$Oligodendrocyte_Cahoy$aucThr$thresholds
```

```{r}
library("ggplot2")
geneSetName <- rownames(cells_AUC)[grep("geneSet2", rownames(cells_AUC))]
AUCell_plotHist(cells_AUC[geneSetName,], aucThr=0.28)
abline(v=0.28)
```

```{r}
quartz()
newSelectedCells <- names(which(getAUC(cells_AUC)["geneSet2",]>0.058))
length(newSelectedCells)
```

```{r}
library("Seurat")

exprMatrix$is_ec <- ifelse(colnames(exprMatrix) %in% newSelectedCells, "EV", "non_EV")
DimPlot(reduction = "umap",object=exprMatrix, group.by = "is_ec", label = TRUE)

```


